# 部署兼容说明

> 本文档说明如何将 Taro 项目与原有的 GitHub 仓库、域名、EdgeOne 托管方式兼容

---

## 一、兼容性总结

| 项目 | 兼容性 | 说明 |
|------|--------|------|
| GitHub 仓库 | ✅ 完全兼容 | 可直接替换原项目代码 |
| 域名 (kegel.sparkinspyer.com) | ✅ 完全兼容 | 无需修改 |
| EdgeOne 托管 | ✅ 完全兼容 | 构建产物结构一致 |

---

## 二、构建产物对比

### 原项目 (Vite)

```
dist/
├── index.html
├── favicon.svg
└── assets/
    ├── index-xxx.js
    └── index-xxx.css
```

### 新项目 (Taro H5)

```
dist/
├── index.html
├── static/
│   ├── js/
│   │   └── app.xxx.js
│   └── css/
│       └── app.xxx.css
└── ...
```

**关键点**：两者都是静态文件，EdgeOne 只需要托管 `dist/` 目录即可。

---

## 三、集成方案

### 方案 A：替换原仓库代码（推荐）

直接用 Taro 项目替换原有的 Vite 项目：

```bash
# 1. 备份原项目（可选）
cd /Users/david/Desktop/pitem
cp -r 提刚V2.0 提刚V2.0-backup

# 2. 复制 Taro 项目到原项目位置
rm -rf 提刚V2.0/*
cp -r tigan-taro/* 提刚V2.0/

# 3. 进入目录并安装依赖
cd 提刚V2.0
npm install

# 4. 测试构建
npm run build

# 5. 推送到 GitHub
git add .
git commit -m "refactor: 迁移至 Taro 框架，支持小程序"
git push
```

EdgeOne 会自动拉取新代码并部署。

### 方案 B：创建新仓库

如果希望保留原项目，可以创建新仓库：

1. 在 GitHub 创建新仓库（如 `kegel-trainer-taro`）
2. 推送 Taro 项目到新仓库
3. 在 EdgeOne 中配置新仓库
4. 将域名指向新项目

---

## 四、EdgeOne 配置说明

### 无需修改的配置

- **构建命令**：`npm run build`（与原项目一致）
- **输出目录**：`dist`（已配置一致）
- **域名绑定**：保持不变

### 可能需要确认的配置

| 配置项 | 值 |
|--------|-----|
| 构建命令 | `npm run build` |
| 输出目录 | `dist` |
| 安装命令 | `npm install` |
| Node 版本 | >= 16 |

---

## 五、构建命令对比

| 命令 | 原项目 (Vite) | 新项目 (Taro) | 说明 |
|------|---------------|---------------|------|
| `npm run dev` | 启动开发服务器 | 启动 H5 开发模式 | ✅ 兼容 |
| `npm run build` | 构建生产版本 | 构建 H5 版本 | ✅ 兼容 |
| `npm run preview` | 预览生产版本 | 预览生产版本 | ✅ 兼容 |

**新增命令**（小程序相关）：

| 命令 | 说明 |
|------|------|
| `npm run dev:weapp` | 微信小程序开发模式 |
| `npm run build:weapp` | 构建微信小程序 |

---

## 六、迁移步骤详解

### 步骤 1：安装依赖

```bash
cd /Users/david/Desktop/pitem/tigan-taro
npm install
```

### 步骤 2：本地测试 H5

```bash
npm run dev:h5
# 浏览器访问 http://localhost:10086
```

### 步骤 3：构建测试

```bash
npm run build
# 检查 dist/ 目录是否正常生成
```

### 步骤 4：替换原项目并推送

```bash
# 假设原项目在同级目录
cd /Users/david/Desktop/pitem

# 保留原项目的 .git 目录
mv 提刚V2.0/.git tigan-taro/

# 替换
rm -rf 提刚V2.0
mv tigan-taro 提刚V2.0

# 推送
cd 提刚V2.0
git add .
git commit -m "refactor: 迁移至 Taro，支持 H5 + 微信小程序"
git push
```

### 步骤 5：验证部署

1. 等待 EdgeOne 自动构建（通常 1-3 分钟）
2. 访问 https://kegel.sparkinspyer.com 验证

---

## 七、常见问题

### Q: EdgeOne 构建失败？

**A**: 检查以下配置：
- Node 版本 >= 16
- 构建命令：`npm run build`
- 输出目录：`dist`

### Q: 样式显示异常？

**A**: 可能需要清除 EdgeOne 缓存，或等待 CDN 刷新。

### Q: 原项目还能访问吗？

**A**: 替换后原项目代码会被新项目覆盖。建议先备份：
```bash
cp -r 提刚V2.0 提刚V2.0-vite-backup
```

---

## 八、回滚方案

如果新版本有问题，可以快速回滚：

```bash
# 如果有备份
cd /Users/david/Desktop/pitem
rm -rf 提刚V2.0
mv 提刚V2.0-vite-backup 提刚V2.0
cd 提刚V2.0
git add .
git commit -m "revert: 回滚到 Vite 版本"
git push
```

---

*最后更新: 2024-12-15*

